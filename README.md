# Detection and Monitoring Lab

## Objective

The Detection and Monitoring Lab project aims to establish a controlled test environment for simulating and detecting cyberattacks. The main objective is to ingest logs within a Security Information and Event Management (SIEM) system. In this lab, I generated test telemetry to mimic real-world attack scenarios. This allowed me to gain hands-on experience with a SIEM and develop a deeper understanding of security concepts, locating IoCs, and defensive strategies.

### Skills Learned

- Deeper understanding of SIEM concepts
- Practical application of SIEM concepts
- Proficiency in analyzing and interpreting endpoint logs.
- Use of Splunk and the SPL quering language

### Tools Used

- Splunk SIEM for log ingestion and search
- Ubuntu Linux Server to act as the Splunk server
- Kali Linux to simulate a real-world attack and generate telemtry
- Windows Active Directory to simulate a real-world Domain environment
- Symon was downloaded and configured on each endpoint

### Network Diagram
<img src="https://github.com/user-attachments/assets/3d25abd0-e4b0-45a4-9e90-fa331fa44ad1" alt="Network Diagram" width="500" />

## Lab 1: Brute Force Attack

#### Description

This lab is meant to simulate an attacker on the network trying to brute force a vulnerable user's account. 

#### Step 1
The first step taken by the attacker was to conduct a network scan using Nmap to find any open ports on the hosts. With this scan, the attacker discovered that port 3389 was open on 192.168.10.100, which is the Windows 10 machine.

<img src="https://github.com/user-attachments/assets/1baa5e3a-df8c-4719-a150-2524f4747f02" alt="Nmap Scan" width="500" />

#### Step 2
Using the Kali Linux tool Crowbar and a pre-loaded common password file, the attacker then committed a brute force attack. The flag -b was used to specify the target service on the victim machine, which is RDP. The -u flag specifies the username of the victim, while the -C flag is used to indicate the password file for this attack; in this case, it is passwords.txt. The -s flag specifies the server or target machine, which is our Windows 10 machine. You can see that once this command is run, it successfully matched the password of "sbob" to "Password1."

<img src="https://github.com/user-attachments/assets/04dabe5d-a5af-4376-9932-df3407fe431d" alt="Password command" width="500" />

#### Step 3
Now that the attack has been committed, we can go to our SIEM, which in this case is Splunk, and look for any signs of activity. The search used to retrieve the fields below was a simple search for the username of the affected user. Through this, we can see the event codes generated by this user. Notably, one of these fields is Event Code 4625, which has a count of 43. This is important because this event code signifies a failed logon attempt, and a high number of these can indicate a brute force attack. While this could initially be seen as non-malicious, a closer examination of the logs reveals that each of these events occurred within milliseconds of each other, strongly suggesting a brute force attack.

<img src="https://github.com/user-attachments/assets/c40fe0af-9584-4127-9212-d461ec0bd5fd" alt="Fields" width="500" />

##### Beginning attack time stamps
<img src="https://github.com/user-attachments/assets/54729230-0a27-4916-b027-6948ff8214ed" alt="Time stamps" width="500" />

##### End of attack time stamps
<img src="https://github.com/user-attachments/assets/d2b3a6f2-382e-4535-a56a-b66ce255a6c0" alt="Time stamps" width="500" />

#### Step 4
Digging deeper into these logs, we can see that these attacks came from an unknown source address and workstation name. Given that these failed logon attempts originated from an unknown source and occurred within seconds of each other, we can infer that this is a malicious brute force attack.

<img src="https://github.com/user-attachments/assets/1c741a7f-733c-4922-a6ed-054d835e04dd" alt="logs" width="500" />

#### Step 5
Now that we have this information, we can create a Splunk query to display any logon attempts from this unknown IP, the usernames it attempted to log on as, and the number of logon attempts. In this query, we are searching for any logs that contain Event Code 4625 with any account name from a source address that isnâ€™t the local host. We then use the stats command to retrieve and display the account names the malicious address tried to log on as, along with the total number of logon attempts from this address.

<img src="https://github.com/user-attachments/assets/f211a019-aefa-4db5-b747-31f01e4090f3" alt="query" width="500" />

#### Step 5
In this step, I modified the query to focus on successful logon attempts instead of failed ones, to determine if the attacker was successful. As shown in the screenshot below, the attacker was indeed successful.

<img src="https://github.com/user-attachments/assets/fc40cd9e-b531-42a7-8d3b-1efcfa8fd43f" alt="query" width="800" />

#### Conclusion

With the information gathered in Splunk, we can now report on this attack. We can report on the malicious IP and the accounts they were targeting. We can also use this information to remediate this incident. Some of the steps we can take to remediate and mitigate are blocking the malicious IP from the network, advising affected users to change their passwords, updating the password policy, closing any non-essential open ports on end hosts, setting up alerting, implementing account lockout policies, implementing rate limiting, and more.
